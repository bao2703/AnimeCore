@model Movie
@inject IEpisodeRepository EpisodeRepository

@{
    ViewData[Constant.Title] = Model.Name + " - Watch";
    dynamic advertisement = ViewData["Advertisement"];
}

@section slide {
    <div class="container">
        <div class="row">
            <div class="col-xs-12" id="player-area">
                <a href="" id="ads-area" title="" target="_blank">
                    <video class="col-xs-12" autoplay="">
                        <source src="" type="video/mp4"/>
                    </video>
                </a>
            </div>
        </div>
    </div>
}

<div class="panel panel-info" id="panel-movie-detail">
    <div class="panel-heading">
        Episode list
    </div>
    <div class="panel-body">
        <div class="row">
            <div class="col-sm-12">
                @foreach (var item in EpisodeRepository.OrderByName(Model.Episodes))
                {
                    <button class="btn btn-primary btn-episode" data-url="@item.Url" style="margin-bottom: 10px">@(item.Name.Length == 1 ? "0" : "")@item.Name</button>
                }
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function() {
            $("#ads-area video").attr("src", "@advertisement.Source");
            $("#ads-area").attr("href", "@advertisement.Url");
            $("#ads-area").attr("title", "@advertisement.Title");
            $("video").on("ended",
                function() {
                    $(this).remove();
                    $("#player-area")
                        .append('<iframe id="movie-player" class="col-xs-12" src="" allowfullscreen></iframe>');
                    $('.btn-episode:first').trigger('click');
                });

            $('.btn-episode').on('click',
                function() {
                    $('#movie-player').attr('src', $(this).data('url'));
                    $('.btn-episode').removeClass('active');
                    $(this).addClass('active');
                });
        });
    </script>
}